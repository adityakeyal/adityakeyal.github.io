<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=msapplication-TileImage content="/ms-icon-144x144.png"><meta name=msapplication-TileColor content="#1793d0"><meta name=theme-color content="#1793d0"><title>Java Performance Issues | Random thoughts of a Developer</title><meta property="og:title" content="Java Performance Issues - Random thoughts of a Developer"><meta property="og:type" content="article"><meta property="article:published_time" content="2021-10-13T07:49:02+08:00"><meta property="article:modified_time" content="2021-10-13T07:49:02+08:00"><meta name=keywords content="HTML,hugo,CSS"><meta name=description content="Java Performance Issues"><meta name=author content><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png><link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png><link rel=stylesheet type=text/css href=/css/hulga.min.css></head><body><div id=main><section class="hero is-primary shadow-hero is-bold"><div class=hero-head><nav class="navbar is-primary"><div class=container><div class=navbar-brand><a class=navbar-item href=https://adityakeyal.github.io/>Random thoughts of a Developer</a>
<a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div class=navbar-menu id=navMenu><div class=navbar-end></div></div></div></nav></div><div class=hero-body><header class="container has-text-centered"><h1 class="title post-title">Java Performance Issues</h1><h2 class=subtitle><time class=post-meta>2021/10/13</time> ・
<span class="post-tag post-meta"><a href=https://adityakeyal.github.io//categories/java>java</a></span></h2><div class="tagbox post-meta"><span class=post-tag><a href=https://adityakeyal.github.io//tags/java>#java</a></span></div></header></div></section><section class=section><div class=container><div class=columns><div class="column is-1 is-hidden-mobile"></div><div class="column is-8"><article class=content id=post-content><h2 id=performance-issue---what-and-why>Performance Issue - what and why</h2><p>There is nothing more daunting and interesting than issues related to performance. While we pay a lot of &ldquo;undue attention&rdquo; to performance in code reviews, &ldquo;Don&rsquo;t use a Linked List, use an Array List or use a Linked List not an Array List&rdquo;, we often miss the bigger picture.
Most performance issues don&rsquo;t come from usage of type of list or types of for loops, they actually come from the most interesting and tricky parts of code.
It could be a thread which is resulting in a deadlock due to a behavior in HashMap, it could be a very poorly written SQL query that when subjected to production loads is taking exceptionally high time,
or even the more common suspects of Garbage Collector (GC).</p><p>The challenge with such issues are no expert code reviewer can actually identify such issues by walking through the code. Albeit I am sure there are multiple people who love to claim of an exception to the rule.
The real challenge is, when presented with a problem such as this, is when the issue is</p><ol><li>Sporadic</li><li>Indeterministic</li><li>Happens only on production or UAT</li></ol><p>How can we actually find the root cause of such issues without relying on some expensive tool or mere guess work.</p><h2 id=restart-and-it-works>Restart and it works</h2><p>How many times have we encountered issues which can be solved by a simple restart. While a restart is a short term workaround, with that 1 restart we losse credible information. Before we restart (either the machine or the process) we must make it a point to capture some additional metrics
Some critical things to capture</p><ul><li>CPU Utilization</li><li>Memory utilization</li><li>JVM Metrics</li><li>Log files</li></ul><p>These are explained is more details below</p><h3 id=cpu-metrics>CPU Metrics</h3><p>The first thing to observe is the CPU utilization at a machine and process level. The easiest way to capture them is through the top command.</p><h4 id=command>Command:</h4><pre><code>$ top -o +%CPU
</code></pre><h4 id=output>Output</h4><p><img src=/java-performance/cpu-utilization.png alt=cpu-utilization.png></p><p>Some points to consider:</p><ol><li>Total CPU Utilization - This gives a good indicator if the slowness is due to CPU starvation. This value can go upto 100%*[no of cores].</li><li>Top CPU hogging process. This is a good indicator to find the culprit. Sometimes this could be your own app. Sometmes it could be another app eating away at crucial resources and starving your app from CPU.</li></ol><h3 id=memory-metrics>Memory Metrics</h3><p>The next thing we need to capture is the memory utilization at a machine and process level. The easiest way to capture them is through the same top command.</p><h4 id=command-1>Command:</h4><pre><code>$ top -o +%MEM
</code></pre><h4 id=output-1>Output</h4><p><img src=/java-performance/memory-utilization.png alt=memory-utilization.png></p><p>Some points to consider:</p><ol><li>Total memory utilization - This gives a good indicator if the slowness is due to low memory availability. The classical symptopms will include low &ldquo;KiB Mem&rdquo; and high usage of &ldquo;KiB Swap&rdquo;. If the system has is using a lot of swap memory, a lot of the resources will be used in swapping data in and out of the page memory.</li><li>Top memory hogging process. - Like the CPU, this is a good indicator to find the culprit process. The next step of action would depend on if the process isyour own app or a stray app.</li></ol><h3 id=jvm-metrics>JVM Metrics</h3><p>While CPU and Memory are good indicators to the problematic process, the probability that the problem lies with your own process is quite high. In such cases, the next logical step is to identify what within your process is eating the memory. The first step to do that is capture Jvm Metrics</p><h4 id=command-2>Command:</h4><pre><code>$ jstat -gc &lt;process pid&gt;
</code></pre><p>The process pid should be the PID of the JAVA process for which we want to capture GC statistics</p><h4 id=output-2>Output</h4><pre><code>Timestamp	S0C	S1C	S0U	S1U	EC	EU	OC	OU	PC	PU	YGC	YGCT	FGC	FGCT	GCT
944.3	40960	40960	0	27322.2	617472	276759.8	324096	273346.9	120320	110437.9	69	2.058	3	0.783	2.841
</code></pre><p>Using the above data you can arrive at a few important considerations:</p><ol><li>Total Garbage Collections - FGC Value</li><li>Total Heap Used - S0U + EU + OU + PU</li></ol><p>If you see a very high value of FGC or a trend of increasing FGC its a direct indicator that there is a problem with too much Garbage collection indicating either a memory leak or less allocated memory.</p><p>The total heap used will also give a good indicator towards the same.</p><h3 id=log-files>Log Files</h3><p>The most important indicator of any application issue is the log file. You should keep an eye out for some standard issues like</p><ul><li>Out of Memory Error</li><li>Stack Overflow Error</li><li>Out of connection error</li><li>Too many open files error
The above list is by no measure exhaustive. However this is a good starting point to identify the issue.
In subsequent articles we will try to discuss other issues that we encounter and how to move forward on the same.</li></ul></article></div><div class="column is-hidden-mobile"><div class=sidebar id=toc><div class="post post-toc" id=post-toc></div></div></div></div></div></div></section></div><footer class=footer><div class="content has-text-centered"><p>Powered by <a href=https://gohugo.io>Hugo</a>. Theme <a href=https://www.github.com/wlh320/hugo-theme-hulga>Hulga</a></p><p>Copyright © 2020 wlh. All rights reserved.</p></div></footer><script src=https://cdn.jsdelivr.net/npm/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js></script><script>addBackToTop({diameter:42,backgroundColor:"#1793d0",innerHTML:'<svg viewBox="0 0 24 24"><path d="M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"/></svg>',textColor:'#fff'});</script><script type=text/javascript>document.addEventListener('DOMContentLoaded',()=>{const $navbarBurgers=Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'),0);if($navbarBurgers.length>0){$navbarBurgers.forEach(el=>{el.addEventListener('click',()=>{const target=el.dataset.target;const $target=document.getElementById(target);el.classList.toggle('is-active');$target.classList.toggle('is-active');});});}});</script><link id=hlcss rel=stylesheet type=text/css><script>function addCss(url){var link=document.getElementById('hlcss');link.href=url;}
var darkcss="https://adityakeyal.github.io/css/monokailight.css"
var lightcss="https://adityakeyal.github.io/css/monokailight.css"
if(window.matchMedia('(prefers-color-scheme)').media==='not all'){addCss(lightcss);}else if(window.matchMedia("(prefers-color-scheme: dark)").matches){addCss(darkcss);}else{addCss(lightcss);}
window.matchMedia("(prefers-color-scheme: dark)").addListener(e=>e.matches&&addCss(darkcss));window.matchMedia("(prefers-color-scheme: light)").addListener(e=>e.matches&&addCss(lightcss));</script><script src=https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js></script><script>anchors.options={placement:'left',icon:'#'};anchors.add('.content h1, .content h2, .content h3');</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity="sha256-tn6hZ2YGDv0w1/DaFL4MiUoXuAVclrtFZs13ch3TB9M=" crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity="sha256-1qhJwAgsSPVSSjlQVTewHS49eaoAbOz651dveUANVBI=" crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity="sha256-oEuQVLwO5Ii6subChtLbrY5gx7NDRU+UJJ9jvvau+FI=" crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:true},{left:"\\[",right:"\\]",display:true},{left:"$",right:"$",display:false},{left:"\\(",right:"\\)",display:false}]});});</script><link rel=stylesheet type=text/css href=https://adityakeyal.github.io/css/toc.min.css><script src=https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js></script><script>tocbot.init({tocSelector:'.post-toc',contentSelector:'#post-content',headingSelector:'h1, h2, h3',collapseDepth:6,scrollSmooth:true,positionFixedSelector:'.post-toc',fixedSidebarOffset:273,});</script></body></html>