<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=msapplication-TileImage content="/ms-icon-144x144.png"><meta name=msapplication-TileColor content="#1793d0"><meta name=theme-color content="#1793d0"><title>Monitoring With Zabbix | Random thoughts of a Developer</title><meta property="og:title" content="Monitoring With Zabbix - Random thoughts of a Developer"><meta property="og:type" content="article"><meta property="article:published_time" content="2020-12-31T11:05:23+08:00"><meta property="article:modified_time" content="2020-12-31T11:05:23+08:00"><meta name=keywords content="HTML,hugo,CSS"><meta name=description content="Monitoring With Zabbix"><meta name=author content><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png><link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png><link rel=stylesheet type=text/css href=/css/hulga.min.css></head><body><div id=main><section class="hero is-primary shadow-hero is-bold"><div class=hero-head><nav class="navbar is-primary"><div class=container><div class=navbar-brand><a class=navbar-item href=https://adityakeyal.github.io/>Random thoughts of a Developer</a>
<a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div class=navbar-menu id=navMenu><div class=navbar-end></div></div></div></nav></div><div class=hero-body><header class="container has-text-centered"><h1 class="title post-title">Monitoring With Zabbix</h1><h2 class=subtitle><time class=post-meta>2020/12/31</time> ・
<span class="post-tag post-meta"><a href=https://adityakeyal.github.io//categories/production-monitoring>production monitoring</a></span></h2><div class="tagbox post-meta"><span class=post-tag><a href=https://adityakeyal.github.io//tags/zabbix>#zabbix</a></span></div></header></div></section><section class=section><div class=container><div class=columns><div class="column is-1 is-hidden-mobile"></div><div class="column is-8"><article class=content id=post-content><h1 id=overview-of-monitoring>Overview of Monitoring</h1><h2 id=what-is-monitoring>What is monitoring?</h2><p>To understand monitoring, let us first try an understand how is monitoring defined.
<strong>Definition:</strong></p><blockquote><p><strong>Observe</strong> and check the <em>progress</em> or <strong>quality</strong> of (something) over a period of time; keep under <strong>systematic review</strong>.</p></blockquote><p>Lets understand the critical words from the above definition.</p><ul><li>Observe</li><li>Quality</li><li>Systemic review</li></ul><p>The idea behind any monitoring solution is to be able to continuously observe quality parameters.
Here the quality should be quantitative , i.e. it should be measurable in units.
A simple example is when you have a fever, the doctors ask you to measure the temperature at a regular interval. They rely on absolute measurement over a period of time. If you had a sudden fever spike once and only once, often its considered an abberation and can be given lower priority.</p><h2 id=why-should-we-monitor>Why should we monitor?</h2><h3 id=know-when-something-is-wrong>Know when something is wrong</h3><p>As a site owner/ system administrator or even a user, I want to know if a particular site is not working properly. This allows people to take informed decisions and avoid bigger issues.
One should be on the lookout for symtoms rather than wait for a full blown disaster.</p><p><img src=/zabbix/d70c895252d24789978cd01490a3fdc8.png alt=Disaster></p><h3 id=understand-business-impact>Understand business impact</h3><p>Another critical reason to monitor is often driven by the need to understand the business impact.
If you are running an application, implies there is some impact. The impact could be to paying customers it could be to your shareholders or it could be to simply your or your company&rsquo;s reputation.</p><p>The impact may sometimes be small like :
<img src=/zabbix/6b0cad00d99e400c81ffed1e24c8cdba.png alt=425d355943aadbe4403827d8a8c42e10.png></p><p>or it can be huge</p><blockquote><p>A 63-minute Amazon outage on its “Prime” sales day in 2018 cost the company nearly $100 million (£76 million) according to an estimate```</p></blockquote><blockquote><p>In March 2015, a 12-hour Apple store outage cost the company $25 million.</p></blockquote><blockquote><p>In August 2016, a five-hour power outage in an operation center caused 2,000 cancelled flights and an estimated loss of $150 million for Delta Airlines.</p></blockquote><blockquote><p>In March 2019, a 14-hour outage cost facebook an estimated $90 million.</p></blockquote><blockquote><p>In 2013 , Google temporarily went dark for 5 minutes, causing a 40% drop in web traffic</p></blockquote><p>The value of brand image can never be understated.</p><h3 id=find-the-root-cause-fast>Find the root cause. Fast</h3><p><img src=/zabbix/442d975fd3e14faca2b40cbd2426484e.png alt=d8988bad1eaf292d0203a4a48dd19d79.png>
<img src=/zabbix/a949ad2d28ef49deb0c6080821bbb1db.png alt=33f79bc2c5f2954e4e604e4accaf90af.png></p><p>Whenever an issue happens, the first intinct is to do everything to resolve the problem quickly. However something that is of equally importance (if not more)is being able to find the root cause of the issue.
To find any root cause, we need a lot of runtime information, and that is where the continuous monitoring comes into play.</p><p>Having enough data helps us find proper root cause.</p><h3 id=dont-ignore-the-symtoms>Don&rsquo;t ignore the symtoms</h3><p><img src=/zabbix/6e40d46ee5b047de9022c6966ba83da5.png alt=4b113b92d96be99df995285c6c7fd264.png></p><h1 id=monitoring-with-zabbix>Monitoring with Zabbix</h1><h2 id=why-zabbix>Why Zabbix?</h2><ul><li>Enterprise Class open sourced monitoring solution</li><li>Well established in industry (22+ years)</li><li>Support for Network monitoring, Server monitoring, Application monitoring , Cloud Monitoring, Services Monitoring</li><li>Free Free Free!!!</li></ul><p>While there are multiple commercial monitoring solutions available today, Zabbix provides an open source alternative that is ewll established.
Being open source means, you can provide solutions for your own problems and with an active community support, there are multiple support base available.
Finally, for many companies and individuals, spending a lot of money on monitoring (which is not their primary offerring) is not always possible. That is where it helps to have a free alternative.</p><h2 id=architecture>Architecture</h2><ul><li>Zabbix Server</li><li>Zabbix Agent</li><li>Zabbix Proxy (optional)</li></ul><p>There are 3 primary components in the Zabbix architecture. Working on a classical server-agent model, it has an optional intermediary layer of proxies.
Let us describe these components in more details.</p><h4 id=zabbix-server>Zabbix Server</h4><p>Zabbix Server is the central process of Zabbix Software. This is the brain of the system and it performs the below functions</p><ul><li>Polling</li><li>Trapping of data</li><li>Calculate Trigger</li><li>Send notifications to users</li></ul><p>Stores all data in DB (Postgres or MySQL) and written in C and PHP.</p><p>Lets cover the key contepts</p><ul><li>Key concepts<ul><li>Hosts</li><li>Items</li><li>Triggers</li><li>Actions</li></ul></li></ul><h3 id=host>Host</h3><p>When setting up a host there are generally 2 approaches</p><ul><li>Auto discovered hosts</li><li>Manually configured hosts</li></ul><p>While Manually configured hosts work for most deployment models, the auto discovered hosts are a necessity when it comes to Microservices and autoscaling patterns in todays cloud environment.</p><p>Generally the overall flow is as below:</p><p><img src=/zabbix/2021-01-11-11-55-26.png alt=/zabbix/2021-01-11-11-55-26.png></p><h3 id=items>Items</h3><p>An item is an individual metric, used for monitoring the server. Items can have the below configurations</p><ul><li>Update Interval - Frequency at which we should monitor the item</li><li>History Period - The total time for which we need to save the item in the database</li><li>Trends Period - The total time for which we need to save the trend (value average over an hour) in the database</li><li>Item Type<ul><li>Zabbix Agent (Passive)</li><li>Zabbix Agent (Active)</li><li>HTTP Agent</li><li>SSH Agent</li><li>JMX Agent</li><li>Zabbix Trapper</li><li>Dependent Items</li><li>Log File Monitoring</li></ul></li></ul><h4 id=zabbix-agent>Zabbix Agent</h4><p>The below diagram sums the difference between a Zabbix Active and Zabbix Passive agent.
<img src=/zabbix/2021-01-11-12-17-23.png alt></p><p>If you use the Zabbix agent in the passive mode, it means that the poller (internal server process) connects to the agent on port 10050/TCP and polls for a certain value (e.g., host CPU load). The poller waits until the agent on the host responds with the value. Then the server gets the value back, and the connection closes.</p><p>In the active mode, all data processing is performed on the agent, without the interference of pollers. However, the agent must know what metrics should be monitored, and that is why the agent connects to the trapper port 10051/TCP of the server once every two minutes (by default). The agent requests the information about the items, and then performs the monitoring on the host and pushes the data to the server via the same TCP port.</p><p>While the decision of Active vs Passive can be driven by</p><ul><li>Topology benefits (if incoming connections are allowed or only outgoing connections are allowed)</li><li>Performance benefits (For quick checks Active Agent is better)</li></ul><h4 id=configuration>Configuration</h4><h5 id=passive-agent>Passive Agent</h5><p>For a passive agent the configuration is more simple. It just needs the below values:</p><ul><li>Server - Comma separated list of IP values from which Agent will accept incoming connections
<img src=/zabbix/2021-01-11-12-44-54.png alt="Passive Setup"></li></ul><h5 id=active-agent>Active Agent</h5><p>Active agent requires a more in-depth configuration.</p><ul><li>ServerActive - This is the list of IP addresses and DNS names of your Zabbix servers or proxies to which the agent will connect once every two minutes to request the configuration</li><li>Hostname - Hostname must match the name configured in the front-end of Zabbix (case sensitive)
To reduce confusion the hostname should be unique in case of Active Agents</li></ul><h4 id=http-agent>HTTP Agent</h4><p>These agents allow you to make a HTTP(S) call and receive the returned response as value. This does not require any agent to be installed on the target machine.</p><ul><li>The item is checked by the Zabbix Server (or Proxy)</li><li>Has support for HTTP Authentication (Basic/Digest/NTLM)</li></ul><h4 id=ssh-agent>SSH Agent</h4><p>SSH Checks allow to connect to a target machine using SSH protocol and then execute a script. There are few things to take care of here:</p><ul><li>Support for passphrase and key based authentication</li><li>For key based authentication save te key location to the SSHKeyLocation property</li></ul><h4 id=jmx-agent>JMX Agent</h4><p>Allows JMX basedmonitoring of any running java applications. We need to install an additional Zabbix Daemon called &ldquo;Zabbix Java Gateway&rdquo;.
The flow of control goes as below:</p><p><strong>Option#1</strong></p><p><img src=/zabbix/2021-01-11-14-34-39.png alt></p><p><strong>Option#2</strong></p><p><img src=/zabbix/2021-01-11-14-36-21.png alt></p><p>Some important points to consider:</p><p>On Zabbix Server:</p><ul><li>JavaGateway - The IP on which the Java Gateway is available</li><li>StartJavaPoller - The number of pollers used to poll the JMX API</li></ul><p>On the Item:</p><ul><li>IP and Port of the JMX Endpoint</li><li>Authentication (if required)</li><li>JMX Endpoint(eg. jmx[com.example:Type=Hello,apple.weight])</li></ul><h4 id=zabbix-trapper>Zabbix Trapper</h4><p>Most of the monitoring in Zabbix is based on pull/poll based monitoring. In most cases the central server polls the agent and the agent/gateway in turn polls the component.
The Zabbix Trapper provides a &ldquo;push&rdquo; based model.</p><p>The easiest way to push data is using the &ldquo;zabbix_sender&rdquo; tool which can be installed.</p><p><code>zabbix_sender -z &lt;server IP address> -p 10051 -s "New host" -k trap -o "test value"</code></p><h4 id=dependent-items>Dependent Items</h4><p>There are situations when one item gathers multiple metrics at a time or it even makes more sense to collect related metrics simultaneously, for example:</p><p>CPU utilization of individual cores
Incoming/outgoing/total network traffic
To allow for bulk metric collection and simultaneous use in several related items, Zabbix supports dependent items. Dependent items depend on the master item that collects their data simultaneously, in one query. A new value for the master item automatically populates the values of the dependent items. Dependent items cannot have a different update interval than the master item.</p><p>Zabbix preprocessing options can be used to extract the part that is needed for the dependent item from the master item data.</p><h4 id=log-file-monitoring>Log File Monitoring</h4><p>Zabbix can be used for centralized monitoring and analysis of log files with/without log rotation support.
Notifications can be used to warn users when a log file contains certain strings or string patterns.</p><p>To monitor a log file you must have:</p><ul><li>Zabbix agent running on the host</li><li>log monitoring item set up</li></ul><p>A log files requires an Zabbix Active Agent. Hence all configuration must match that of an Active Agent.</p><h3 id=triggers>Triggers</h3><p>Triggers help evaluate if a particular item value falls within the acceptable range (OK) or unacceptale range (PROBLEM).
Triggers are recalculated everytime a value (item) is received from the server.</p><p>Triggers can be evaluated using functions like</p><table><thead><tr><th>Function</th><th>Description</th></tr></thead><tbody><tr><td>nodata</td><td>If there is no data from the server</td></tr><tr><td>last(#n)</td><td>Check the nth last value for an item</td></tr><tr><td>avg(#n)</td><td>Check the average value over the last n items</td></tr><tr><td>max(#n)</td><td>The maximum value over the last n items</td></tr><tr><td>min(#n)</td><td>The minimum value over the last n items</td></tr><tr><td>and others</td><td></td></tr></tbody></table><h3 id=actions>Actions</h3><p>Actions allow to take action on an event.
There are several types of events generated in Zabbix:</p><ul><li>trigger events - whenever a trigger changes its status (OK→PROBLEM→OK)</li><li>discovery events - when hosts or services are detected</li><li>auto registration events - when active agents are auto-registered by server</li><li>internal events - when an item/low-level discovery rule becomes unsupported or a trigger goes into an unknown state</li></ul><p>Different action can be taken based on the event. Some examples are as below:</p><ol><li>Trigger Events - We can send out notifications (mail/script)</li><li>Discovery Events - Register Items</li><li>AutoRegistration - Create Host and Register Items</li><li>Internal Events - Send notification / Alarm</li></ol><p>The action is completely driven by your business needs.</p><h2 id=more-info>More Info</h2><p><a href=https://blog.zabbix.com/zabbix-agent-active-vs-passive/9207/>Zabbix Agents</a></p></article></div><div class="column is-hidden-mobile"><div class=sidebar id=toc><div class="post post-toc" id=post-toc></div></div></div></div></div></div></section></div><footer class=footer><div class="content has-text-centered"><p>Powered by <a href=https://gohugo.io>Hugo</a>. Theme <a href=https://www.github.com/wlh320/hugo-theme-hulga>Hulga</a></p><p>Copyright © 2020 wlh. All rights reserved.</p></div></footer><script src=https://cdn.jsdelivr.net/npm/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js></script><script>addBackToTop({diameter:42,backgroundColor:"#1793d0",innerHTML:'<svg viewBox="0 0 24 24"><path d="M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"/></svg>',textColor:'#fff'});</script><script type=text/javascript>document.addEventListener('DOMContentLoaded',()=>{const $navbarBurgers=Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'),0);if($navbarBurgers.length>0){$navbarBurgers.forEach(el=>{el.addEventListener('click',()=>{const target=el.dataset.target;const $target=document.getElementById(target);el.classList.toggle('is-active');$target.classList.toggle('is-active');});});}});</script><link id=hlcss rel=stylesheet type=text/css><script>function addCss(url){var link=document.getElementById('hlcss');link.href=url;}
var darkcss="https://adityakeyal.github.io/css/monokailight.css"
var lightcss="https://adityakeyal.github.io/css/monokailight.css"
if(window.matchMedia('(prefers-color-scheme)').media==='not all'){addCss(lightcss);}else if(window.matchMedia("(prefers-color-scheme: dark)").matches){addCss(darkcss);}else{addCss(lightcss);}
window.matchMedia("(prefers-color-scheme: dark)").addListener(e=>e.matches&&addCss(darkcss));window.matchMedia("(prefers-color-scheme: light)").addListener(e=>e.matches&&addCss(lightcss));</script><script src=https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js></script><script>anchors.options={placement:'left',icon:'#'};anchors.add('.content h1, .content h2, .content h3');</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity="sha256-tn6hZ2YGDv0w1/DaFL4MiUoXuAVclrtFZs13ch3TB9M=" crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity="sha256-1qhJwAgsSPVSSjlQVTewHS49eaoAbOz651dveUANVBI=" crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity="sha256-oEuQVLwO5Ii6subChtLbrY5gx7NDRU+UJJ9jvvau+FI=" crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:true},{left:"\\[",right:"\\]",display:true},{left:"$",right:"$",display:false},{left:"\\(",right:"\\)",display:false}]});});</script><link rel=stylesheet type=text/css href=https://adityakeyal.github.io/css/toc.min.css><script src=https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js></script><script>tocbot.init({tocSelector:'.post-toc',contentSelector:'#post-content',headingSelector:'h1, h2, h3',collapseDepth:6,scrollSmooth:true,positionFixedSelector:'.post-toc',fixedSidebarOffset:273,});</script></body></html>